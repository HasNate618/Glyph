<ui:FluentWindow x:Class="Glyph.App.UI.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
        Title="Glyph Settings" Height="800" Width="900"
        WindowStartupLocation="CenterScreen"
        ExtendsContentIntoTitleBar="True">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Title bar with back button -->
        <Grid Grid.Row="0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <ui:Button x:Name="BackButton" Grid.Column="0" 
                       Visibility="Collapsed" 
                       Appearance="Secondary" 
                       Padding="8,4" 
                       Margin="8,0,0,0"
                       Click="BackButton_Click"
                       Icon="{ui:SymbolIcon ArrowLeft24}" 
                       ToolTip="Back to Settings" />
            <ui:TitleBar Grid.Column="1" Title="Glyph Settings" />
        </Grid>

        <!-- Content area - switches between general settings and keymap editor -->
        <ContentControl x:Name="ContentArea" Grid.Row="1">
            <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled" Padding="24,0" x:Name="GeneralSettingsScrollViewer">
                <StackPanel Margin="0,8,0,24" x:Name="GeneralSettingsPanel">
                    <!-- Header with title and version -->
                    <TextBlock FontSize="28" FontWeight="SemiBold" Text="Glyph Settings" Margin="0,0,0,4" />
                    <TextBlock FontSize="12" Foreground="{DynamicResource TextFillColorSecondaryBrush}" Margin="0,0,0,20" x:Name="VersionText" Text="Version (loading...)" />

                    <!-- About section -->
                    <Expander Header="About Glyph" IsExpanded="False" Margin="0,0,0,8">
                        <TextBlock TextWrapping="Wrap" Margin="4,8" LineHeight="20">
                            Glyph is a <Bold>leader-key overlay</Bold> for Windows. Press the <Bold>Glyph key</Bold> to open an overlay, then type short key sequences to trigger actions. Configure your keymaps in YAML, and use themes to customize the appearance.
                        </TextBlock>
                    </Expander>

                    <!-- Glyph Key section -->
                    <Expander Header="Glyph Key" IsExpanded="True" Margin="0,0,0,8">
                        <StackPanel Margin="4,8">
                            <TextBlock TextWrapping="Wrap" Foreground="{DynamicResource TextFillColorSecondaryBrush}" Margin="0,0,0,12" LineHeight="18" FontSize="12">
                                The Glyph key activates the overlay. Click Record, then press your desired key(s). 
                                For key sequences, press multiple keys in order. Click Record again to stop.
                            </TextBlock>
                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="0,0,0,8">
                                <ui:Button x:Name="RecordButton" Width="120" Padding="8,6" Content="Record" Icon="{ui:SymbolIcon Record24}" />
                                <TextBlock x:Name="RecordedGlyphText" Margin="12,0,0,0" VerticalAlignment="Center" Text="(not recording)" Foreground="{DynamicResource TextFillColorTertiaryBrush}" />
                            </StackPanel>
                            <TextBlock x:Name="CurrentGlyphText" Margin="0,4,0,0" Foreground="{DynamicResource TextFillColorSecondaryBrush}" FontSize="12" Text="Glyph: (loading...)" />
                        </StackPanel>
                    </Expander>

                    <!-- Overlay section -->
                    <Expander Header="Overlay" IsExpanded="True" Margin="0,0,0,8">
                        <StackPanel Margin="4,8">
                            <TextBlock FontSize="12" Foreground="{DynamicResource TextFillColorSecondaryBrush}" Margin="0,0,0,6" Text="Theme" />
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                <ComboBox x:Name="ThemeCombo" Width="200" />
                                <ui:Button x:Name="OpenThemesFolderButton" Margin="8,0,0,0" Padding="8,6" Content="Open Themes Folder" Appearance="Secondary" Icon="{ui:SymbolIcon FolderOpen24}" />
                            </StackPanel>

                            <CheckBox x:Name="BreadcrumbsModeCheckBox" Margin="0,0,0,4" Content="Enable breadcrumbs mode (show only inline breadcrumbs)" />
                            <TextBlock TextWrapping="Wrap" Foreground="{DynamicResource TextFillColorTertiaryBrush}" FontSize="11" LineHeight="16" Margin="0,0,0,12">
                                When enabled, the overlay shows only compact breadcrumbs/hints as you type; not the full keymap list.
                            </TextBlock>

                            <CheckBox x:Name="StartWithWindowsCheckBox" Margin="0,0,0,4" Content="Open Glyph at Windows sign-in" />
                            <TextBlock TextWrapping="Wrap" Foreground="{DynamicResource TextFillColorTertiaryBrush}" FontSize="11" LineHeight="16">
                                When enabled, Glyph will start automatically when you sign in to Windows (per-user).
                            </TextBlock>
                        </StackPanel>
                    </Expander>

                    <!-- Keymaps section -->
                    <Expander Header="Keymaps" IsExpanded="True" Margin="0,0,0,8">
                        <StackPanel Margin="4,8">
                            <TextBlock TextWrapping="Wrap" Foreground="{DynamicResource TextFillColorSecondaryBrush}" FontSize="12" Margin="0,0,0,12" LineHeight="18">
                                Edit your keymaps visually with the Keymap Editor. Define key sequences, actions, and nested layers.
                            </TextBlock>
                            <ui:Button x:Name="OpenKeymapEditorButton" Content="Open Keymap Editor" Padding="12,8" HorizontalAlignment="Left" Appearance="Primary" Click="OpenKeymapEditorButton_Click" Icon="{ui:SymbolIcon Keyboard24}" />
                        </StackPanel>
                    </Expander>

                    <!-- Auto-save notice -->
                    <TextBlock Foreground="{DynamicResource TextFillColorTertiaryBrush}" Margin="0,8,0,16" FontSize="12">
                        ðŸ’¾ Settings auto-save â€” changes apply immediately to the running instance.
                    </TextBlock>

                    <!-- Quick Start section -->
                    <Expander Header="Quick Start &amp; Tips" IsExpanded="False" Margin="0,0,0,8">
                        <StackPanel Margin="4,8">
                            <TextBlock TextWrapping="Wrap" Margin="0,0,0,8" LineHeight="20">
                                <Run FontWeight="SemiBold">1. Set your Glyph key:</Run> Click Record above and press the key (e.g., Capslock, CapsLock+Shift).
                            </TextBlock>
                            <TextBlock TextWrapping="Wrap" Margin="0,0,0,8" LineHeight="20">
                                <Run FontWeight="SemiBold">2. Configure keymaps:</Run> Edit the keymaps YAML in the Keymap Editor. Define key sequences and actions. Tip: enable Breadcrumbs mode for a compact overlay.
                            </TextBlock>
                            <TextBlock TextWrapping="Wrap" Margin="0,0,0,8" LineHeight="20">
                                <Run FontWeight="SemiBold">3. Customize themes:</Run> Choose a theme above or create your own in the Themes folder (JSON).
                            </TextBlock>
                            <TextBlock TextWrapping="Wrap" FontSize="11" Foreground="{DynamicResource TextFillColorTertiaryBrush}">
                                For more info and examples, visit https://github.com/HasNate618/Glyph
                            </TextBlock>
                        </StackPanel>
                    </Expander>
                </StackPanel>
            </ScrollViewer>
        </ContentControl>
    </Grid>
</ui:FluentWindow>
